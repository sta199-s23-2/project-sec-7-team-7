---
title: "Heart Disease Analysis"
subtitle: "Report"
format: html
editor: visual
execute:
  echo: true
---

# Introduction and data

The topic we chose to assess is: How does heart disease presence and magnitude vary based on the age, sex, cholesterol, blood sugar, and blood pressure? Furthermore, what variables are the best predictor of whether or not an individual will get heart disease? We chose to research this topic to explore what variables affect the prevalence of heart disease using data from patients in Cleveland, Hungary, Switzerland, and the VA Long Beach. We hope that by examining the correlation between these variables and presence of heart disease, we can gain insight into how/to what extent these variables contribute to a heart disease diagnosis. Understanding what leads to heart disease is incredibly important as it affects hundreds of thousands of people across the world. It can come in many different shapes and forms, such as coronary artery disease, heart failure, and heart valve disorders. According to the CDC, heart disease is responsible for around 1 every 5 deaths which is why it is critical to understand the responsibility of underlying factors.

We hypothesize that firstly, the older an individual is, the higher cholesterol, blood sugar, and blood pressure and individual has, the more likely they are to develop a heart disease of large magnitude. Secondly, we hypothesize that the age, sex, cholesterol, blood sugar, blood pressure, and the number of major vessels are the best predictors of whether or not an individual will develop heart disease.

We do acknowledge the potential ethical concerns of this research, with the main concern being results communication, specifically that we accurately represent our results. If we misinterpret/misrepresent our results unintentionally, it could be concerning, especially given the topic of our research. Ways to prevent this ethical concern is by formulating research questions in a way that tries to find out the truth rather than proving a viewpoint, by including data outliers that may not fit with our hypothesis, and more.

We found the data set on kaggle, but the data was initially collected by the Hungarian Institute of Cardiology, and the Cleveland Clinic Foundation. This synthesis of information was donated to the University of California at Irvine's Machine learning Repository in 1988. Some relevant variables include:

1.  age: (Age of the patient in years
2.  dataset: (place of study)
3.  sex: (Male/Female)
4.  cp: chest pain type (\[typical angina, atypical angina, non-anginal, asymptomatic\])
5.  trestbps: resting blood pressure (resting blood pressure (in mm Hg on admission to the hospital))
6.  chol: (serum cholesterol in mg/dl)
7.  fbs: (if fasting blood sugar \> 120 mg/dl)
8.  restecg: (resting electrocardiographic results)\
    \-- Values: \[normal, stt abnormality, lv hypertrophy\]
9.  thalach: maximum heart rate achieved
10. exang: exercise-induced angina (True/ False)
11. oldpeak: ST depression induced by exercise relative to rest
12. slope: the slope of the peak exercise ST segment
13. ca: number of major vessels (0-3) colored by fluoroscopy
14. thal: \[normal; fixed defect; reversible defect\]
15. num: the predicted attribute 0 means no heart disease, and 1-4 is the degree to which they have it. In this case, 1-4 will be classified as 1, as we are not concerned with the degree to which they have heart disease, just that they have it.

# Methodology

```{r}
#| label: load-tidy

library(tidyverse)
library(tidymodels)

```

```{r}
#| label: load-data
heart_disease <- read_csv("data/heart_disease_uci.csv")
glimpse(heart_disease)
```

```{r}
#| label: change-response-var

heart_disease <- heart_disease |>
  mutate(num = ifelse((num >= 1), 1, 0))
```

```{r}
#| label: heart-disease-based-on-sex
  heart_disease |>
  ggplot(
    aes(x = sex, fill = if_else(num == 1, "Yes", "No"))) + 
    geom_bar(position = "fill") +
  labs(title = "Males vs Females in Heart Disease Rates", 
       x = "Gender",
       y = "Proportion", 
       fill = "Heart Disease Presence") +
  theme_classic() +
  scale_color_viridis_d()

```

```{r}
#| label: heart-disease-based-on-age
  heart_disease |>
    ggplot(
      aes(x = age, fill = if_else(num == 1, "Yes", "No"))
      ) +
    geom_histogram(position = "fill", bins = 30) +
    labs(title = "Heart Disease Rates By Age",
         x = "Age",
         y = "Proportion",
         fill = "Heart Disease Presence") +
    theme_classic() +
    scale_color_viridis_d()
```

As age increases, the proportion of people with heart disease increases.

```{r}
#| label: heart-disease-based-on-cholesterol
  
heart_disease |>
  filter(chol != 0) |>
  ggplot(
    aes(x = chol, fill = if_else(num == 1, "Yes", "No"))
    ) +
  geom_histogram(position = "fill", bins = 20) +
  labs(title = "Heart Disease Rates By Cholesterol",
       x = "Cholesterol Levels",
       y = "Proportion",         
       fill = "Heart Disease Presence") +
  theme_classic() +
  scale_color_viridis_d()
```

As cholesterol increases, heart disease rates increase. We filtered out entries with chol = 0 because that is not possible.

```{r}
#| label: heart-disease-based-on-blood-sugar
  
heart_disease |>
  filter(!is.na(fbs)) |>
  ggplot(
    aes(x = fbs, fill = if_else(num == 1, "Yes", "No"))
    ) +
  geom_bar(position = "fill") +
  labs(title = "Heart Disease Rates By Blood Sugar",
       x = "Blood Sugar Levels Above 150",
       y = "Proportion",         
       fill = "Heart Disease Presence") +
  theme_classic() +
  scale_color_viridis_d()
```

People with fasting blood sugar above 150 are more likely to have heart disease than those with fbs below 150.

```{r}
#| label: heart-disease-based-on-blood-pressure
  
heart_disease |>
  filter(trestbps != 0) |>
  ggplot(
    aes(x = trestbps, fill = if_else(num == 1, "Yes", "No"))
    ) +
  facet_wrap(~sex) + 
  geom_histogram(position = "fill", bins = 30) +
  labs(title = "Heart Disease Rates By Blood Pressure for Each Gender",
       x = "Blood Pressure",
       y = "Proportion",         
       fill = "Heart Disease Presence") +
  theme_classic() +
  scale_color_viridis_d()
```

For females, as blood pressure increases past about 115, higher bp is correlated with higher rates of heart disease. Below 115, lower bp is correlated with higher rates of heart disease. For males, There is not as strong a correlation between blood pressure and heart disease rates. We filtered would bp = 0 because that is not possible and a filler of not recorded data. We chose to facet this by gender because men and women have different average blood pressures.

# Results

```{r}
#| label: find-regression-and-AIC

heart_disease <- heart_disease |>
  mutate(num = as.factor(num))

#sex
sex_reg <- logistic_reg() |>
  set_engine("glm") |>
  fit(num ~ sex, data = heart_disease, family = "binomial")

glance(sex_reg)$AIC

#age
age_reg <- logistic_reg() |>
  set_engine("glm") |>
  fit(num ~ age, data = heart_disease, family = "binomial") 

glance(age_reg)$AIC

#cholesterol
chol_reg <- logistic_reg() |>
  set_engine("glm") |>
  fit(num ~ chol, data = heart_disease |>
        filter(chol != 0), family = "binomial")

glance(chol_reg)$AIC

#blood sugar
fbs_reg <- logistic_reg() |>
  set_engine("glm") |>
  fit(num ~ fbs, data = heart_disease, family = "binomial")

glance(fbs_reg)$AIC

#bp * sex
bp_int_sex_reg <- logistic_reg() |>
  set_engine("glm") |>
  fit(num ~ trestbps * sex, data = heart_disease |>
        filter(trestbps != 0), family = "binomial")

glance(bp_int_sex_reg)$AIC

#cholesterol * age
int_chol_age <- logistic_reg() |>
  set_engine("glm") |>
  fit(num ~ chol * age, data = heart_disease |>
        filter(chol != 0), family = "binomial")

glance(int_chol_age)$AIC

#blood sugar + age
fbs_add_age_reg <- logistic_reg() |>
  set_engine("glm") |>
  fit(num ~ fbs + age, data = heart_disease, family = "binomial")

glance(fbs_add_age_reg)$AIC

#chol + sex
add_chol_sex <- logistic_reg() |>
  set_engine("glm") |>
  fit(num ~ chol + sex, data = heart_disease |>
        filter(chol != 0), family = "binomial")

glance(add_chol_sex)$AIC

```

The best predictor of heart disease rates is an additive model of cholesterol and and sex because it has the lowest AIC of 919. The second best predictor is an interactive model of cholesterol and age, with an AIC of 926. The worst predictor of hearth disease rates is age, with an AIC of 1193.

We use logistic regressions because we are examining whether or not individuals have heart disease, which is a categorical variable that we must convert to a factor in our data transformation. We filtered out data of cholesterol = 0 and blood pressure = 0 for regressions involving those variables because it is not possible for a living individual and is likely to do data not being collected or a null value, as opposed to the actual value. We chose these variables and interactions because we wanted a large breadth of variables potentially correlating with heart disease. We then wanted to see how certain interactions we predicted to be important, such as bp and sex, cholesterol and age, blood sugar and age, and cholesterol and sex, predicted heart disease.
